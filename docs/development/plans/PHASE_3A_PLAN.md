# –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: Phase 3A - Email Threading & Bug Fixes

## üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–≠—Ç–∞–ø**: Phase 3A - Email Threading & Production Readiness
- **–°—Ç–∞—Ç—É—Å**: üìã –ó–ê–ü–õ–ê–ù–ò–†–û–í–ê–ù–û
- **–û–∂–∏–¥–∞–µ–º–∞—è –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞**: 2025-10-21
- **–ü—Ä–µ–¥—ã–¥—É—â–∏–π —ç—Ç–∞–ø**: Phase 2.5 - REST API & Email Integration ‚úÖ

## üéØ –¶–µ–ª–∏ —ç—Ç–∞–ø–∞
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º email threading –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∫ production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é —Å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∏—Å–µ–º.

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 0: Background Tasks Not Starting ‚ùå
**–û–ø–∏—Å–∞–Ω–∏–µ**: –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (Email Puller) –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ API –∑–∞–ø—Ä–æ—Å–∞
**–í–ª–∏—è–Ω–∏–µ**: Email –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ –ø–µ—Ä–≤–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ API
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: CRITICAL

### ‚úÖ –†–ï–®–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:
1. **üî¥ Background Tasks Not Starting** - ‚úÖ –†–ï–®–ï–ù–û
   - –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ —Ç–µ–ø–µ—Ä—å –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –î–û HTTP —Å–µ—Ä–≤–µ—Ä–∞
   - –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è —Å—Ä–∞–∑—É, –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

2. **üü° –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö** - ‚úÖ –†–ï–®–ï–ù–û  
   - `os.Stdout.Sync()` —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã–≤–æ–¥–∞
   - –í—Å–µ –ª–æ–≥–∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á –≤–∏–¥–Ω—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

3. **üü° –ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞** - ‚úÖ –†–ï–®–ï–ù–û
   - –£–±—Ä–∞–Ω—ã debug/–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏
   - –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üéØ –¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–° PHASE 3A

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| Background Tasks Not Starting | ‚úÖ **–†–ï–®–ï–ù–û** | –ú–µ–Ω–µ–¥–∂–µ—Ä —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á + os.Stdout.Sync() |
| Email Threading Not Working | üîÑ **–í –†–ê–ë–û–¢–ï** | –°–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞ |
| CustomerService.ListCustomers Empty | ‚è≥ **–û–ñ–ò–î–ê–ï–¢** | –ü–æ—Å–ª–µ email threading |
| InMemory Message Persistence | ‚è≥ **–û–ñ–ò–î–ê–ï–¢** | –ü–æ—Å–ª–µ email threading |

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Email Threading Not Working ‚ùå
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥–æ–µ –ø–∏—Å—å–º–æ –≤ —Ü–µ–ø–æ—á–∫–µ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –≤–º–µ—Å—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é
**–í–ª–∏—è–Ω–∏–µ**: –§—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏, –ø–ª–æ—Ö–æ–π UX
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: HIGH

### –ü—Ä–æ–±–ª–µ–º–∞ 2: CustomerService.ListCustomers Empty ‚ùå  
**–û–ø–∏—Å–∞–Ω–∏–µ**: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö
**–í–ª–∏—è–Ω–∏–µ**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º–∏ —á–µ—Ä–µ–∑ UI
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: MEDIUM

### –ü—Ä–æ–±–ª–µ–º–∞ 3: InMemory Message Persistence ‚ùå
**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á
**–í–ª–∏—è–Ω–∏–µ**: –ü–æ—Ç–µ—Ä—è –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: MEDIUM

## üìã –ó–∞–¥–∞—á–∏ —ç—Ç–∞–ø–∞

### –ó–∞–¥–∞—á–∞ 1: Email Threading Implementation (2-3 –¥–Ω—è)
- [ ] –î–æ–±–∞–≤–∏—Ç—å FindBySourceMeta –≤ TaskRepository –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –ø–æ message_id, in_reply_to, references
- [ ] –û–±–Ω–æ–≤–∏—Ç—å MessageProcessor –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ü–µ–ø–æ—á–µ–∫, –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è threading –ª–æ–≥–∏–∫–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ email –¥–∞–Ω–Ω—ã–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ó–∞–¥–∞—á–∞ 2: Critical Bug Fixes (1-2 –¥–Ω—è)  
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å CustomerService.ListCustomers
- [ ] –ü–æ—á–∏–Ω–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ InMemory
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á

### –ó–∞–¥–∞—á–∞ 3: API Improvements (1 –¥–µ–Ω—å)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- [ ] –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è email
- [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

### Email Threading Flow
```
Incoming Email ‚Üí Extract Thread IDs ‚Üí 
    Search Existing Tasks ‚Üí 
        Found: Add Message to Existing Task
        Not Found: Create New Task with Thread Meta
```

### API Improvements
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] Email —Ü–µ–ø–æ—á–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –≤ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ
- [ ] Customer list API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ validation errors

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] 100% —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- [ ] Backward compatibility —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –Ω–µ –¥–µ–≥—Ä–∞–¥–∏—Ä—É–µ—Ç

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã

### Phase 3B: PostgreSQL Migration
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è PostgreSQL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### Phase 3C: Production Deployment
- Health checks –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- Deployment –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---
**Maintainer**: URMS-OS Architecture Committee  
**Created**: 2025-10-20
